# Horn: A Lean Tactic for Real Inequality Proofs

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Lean Version](https://img.shields.io/badge/Lean-4-orange)](https://leanprover.github.io/)

`Horn` is a tactic for the Lean 4 proof assistant that enables the automation of proofs for real number inequalities. It's an "encoder" that transforms a Lean's goal into an S-expression of Horn clauses. This allows the user to offload the proof search to a powerful external solver, Imandra-geo, which returns the Lean proof of the orignial goal. 

## How It Works

The workflow is straightforward:

1.  **State your Goal**: Write your theorem involving real number inequalities in Lean.
2.  **Apply the Tactic**: Use the `horn` tactic on your goal with relevant local hypothesis.
3.  **Generate S-Expression**: The tactic converts your goal into an S-Expression format representing the problem as Horn clauses.
4.  **Solve Externally**: Forward the generated S-Expression to the Imandra-geo solver (link to be updated upon release).
5.  **Integrate Proof**: The solver returns a Lean proof certificate that you can use to close the original goal in Lean.

## Getting Started

### Prerequisites

-   [Lean 4](https://leanprover.github.io/lean4/doc/setup.html)
-   [Lake](https://github.com/leanprover/lake)

### Installation

To add `Horn` to your Lean project, add the following line to your `lakefile.toml`:

```lean
[[require]]
name = "real_ineq"
git = { url = "https://github.com/cruisesong7/Imandra-Lean.git", subDir = "real_ineq" }
rev = "main"
```

## Usage

The `horn` tactic has a syntax similar to `simp`, with three main variants for controlling which hypotheses are used.

### 1. `horn`

This basic form translates only the goal, without using any local hypotheses.

```lean
import RealIneq.Horn

theorem no_hyps (x y : ℝ) : 2 * x * y ≤ x^2 + y^2 := by
  horn  

  /- S-expression output:
(<= (* (* 2 x) y) (+ (EXPT x 2) (EXPT y 2)))-/

```

### 2. `horn [...]`

This form translates the goal along with a specific list of hypotheses.

```lean
import RealIneq.Horn

theorem with_hyps (a b c : ℝ) (h1 : 0 < a) (h2 : a ≤ b) : a * c^2 ≤ b * c^2 := by
  horn [h2]

  /- S-expression output:
(IMPLIES (<= a b) (<= (* a (EXPT c 2)) (* b (EXPT c 2))))-/
```

### 3. `horn_all`

This form translates the goal along with all compatible hypotheses in the local context.

```lean
import RealIneq.Horn

theorem with_all_hyps (a b c : ℝ) (h1 : 0 < a) (h2 : a ≤ b) : a * c^2 ≤ b * c^2 := by
  horn_all

  /- S-expression output:
(IMPLIES (AND (< 0 a)
          (<= a b))
    (<= (* a (EXPT c 2)) (* b (EXPT c 2))))-/
```

### 4. `norm_horn`

`norm_horn` is a pre-processing tactic that simplifies the expressions before they are passed to `horn`, as Imandra-geo has some preconditions on the form of input S-experssion. Its main capabilities are:

1.  **Getting rid of division**: It eliminates division by multiplying the inequality by the denominators. This may require adding new hypotheses to ensure the denominators are non-zero.
2.  **Getting rid of square roots**: It performs a change of variables to eliminate square roots. For each `sqrt(x)`, it introduces a new variable `y`, adds the hypothesis `y ^ 2 = x`, and substitutes `x` with `y^2`. User can specify the names for new variables and hypothesis by `(vars :=[...]) (hyps :=[...])`.

Note : `norm_horn` has a synatx similar to `norm_num`, and user can use `at` to specify the locations of where it applies to.

```lean
theorem norm_horn_example (x y : ℝ) (hy : 0 < y)(hx : x > 0) : x / y + Real.sqrt x ≥ 0 := by
  norm_horn 
  
  /- The goal state is transformed to something like:
    x y : ℝ
    hy : 0 < y
    hx : x > 0
    x_sqrt : ℝ := √x
    h_sqrt_x : x_sqrt ^ 2 = x
    ⊢ 0 ≤ x + x_sqrt * y
  -/
  horn_all
  sorry 
```

## Examples and Imandra-geo

While the Imandra-geo solver is not yet publicly released, we have included several examples in the `/Examples` directory to provide a preview of how the complete proof workflow will look.

In particular, **Examples 3 and onward** contain several inequality problems from math competitions that can be solved by the combination of the `horn` tactic and the proofs generated by Imandra-geo. These examples demonstrate the potential of this combined approach for tackling complex mathematical problems.

